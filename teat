local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local Lighting = game:GetService("Lighting")

local function isA(x,c) return typeof(x)=="Instance" and x:IsA(c) end
local function isChar(m) return m and m:FindFirstChildOfClass("Humanoid") and m:FindFirstChild("HumanoidRootPart") end

local function nuke(x)
  if x and x.Parent then
    pcall(function() x:Destroy() end)
  end
end

local function shouldNukeFromChar(d)
  return isA(d,"Accessory")
    or isA(d,"WrapLayer") or isA(d,"WrapTarget") or isA(d,"SurfaceAppearance")
    or isA(d,"Highlight") or isA(d,"ForceField")
    or isA(d,"ParticleEmitter") or isA(d,"Sparkles") or isA(d,"Fire") or isA(d,"Smoke")
    or isA(d,"Trail") or isA(d,"Beam")
    or isA(d,"BillboardGui") or isA(d,"SurfaceGui")
    or isA(d,"PointLight") or isA(d,"SpotLight") or isA(d,"SurfaceLight")
end

local function stripChar(c)
  if not isChar(c) then return end
  for _,d in ipairs(c:GetDescendants()) do
    if shouldNukeFromChar(d) then
      nuke(d)
    end
  end
end

local function watchChar(c)
  if not isChar(c) then return end
  stripChar(c)
  c.DescendantAdded:Connect(function(d)
    if shouldNukeFromChar(d) then
      nuke(d)
    end
  end)
end

-- 1. ALLE bestehenden Characters im Workspace behandeln
for _,model in ipairs(Workspace:GetChildren()) do
  if isChar(model) then
    watchChar(model)
  end
end

-- 2. Workspace: Neue Models überwachen (fängt Klone ab!)
Workspace.ChildAdded:Connect(function(child)
  if isChar(child) then
    task.wait(0.05)
    watchChar(child)
  end
end)

-- 3. Players: Normale Spawns
for _,p in ipairs(Players:GetPlayers()) do
  if p.Character then watchChar(p.Character) end
  p.CharacterAdded:Connect(watchChar)
end

Players.PlayerAdded:Connect(function(p)
  p.CharacterAdded:Connect(watchChar)
end)

-- 4. Fallback: DescendantAdded für Effekte die direkt im Workspace spawnen
Workspace.DescendantAdded:Connect(function(d)
  if shouldNukeFromChar(d) then
    -- Prüfe ob es in einem Character ist
    local ancestor = d.Parent
    while ancestor and ancestor ~= Workspace do
      if isChar(ancestor) then
        nuke(d)
        return
      end
      ancestor = ancestor.Parent
    end
  end
end)

-- 5. Lighting-Effekte (nur Post-Processing)
for _,e in ipairs(Lighting:GetChildren()) do
  if e:IsA("BloomEffect") or e:IsA("BlurEffect") or e:IsA("ColorCorrectionEffect") 
    or e:IsA("DepthOfFieldEffect") or e:IsA("SunRaysEffect") then
    nuke(e)
  end
end

Lighting.ChildAdded:Connect(function(e)
  if e:IsA("BloomEffect") or e:IsA("BlurEffect") or e:IsA("ColorCorrectionEffect") 
    or e:IsA("DepthOfFieldEffect") or e:IsA("SunRaysEffect") then
    nuke(e)
  end
end)

-- 6. Lighting-Properties (moderat)
pcall(function()
  Lighting.GlobalShadows = false
  Lighting.EnvironmentDiffuseScale = 0
  Lighting.EnvironmentSpecularScale = 0
end)

print("✅ Nur Character-Effekte entfernt!")
